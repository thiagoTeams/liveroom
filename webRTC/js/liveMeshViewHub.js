const isLog=!1,consoleDebug=e=>{false};var liveMeshHub=(new signalR.HubConnectionBuilder).withUrl(`${domainLive}/liveMeshHub`,signalR.HttpTransportType.WebSockets).configureLogging(signalR.LogLevel.None).build();function getTokenFCM(e){e("meshRoom")}function initializeLiveRTCHubSignalR(e,t,o,n){liveMeshHub.start().then((()=>{consoleDebug(),""!==t?getTokenFCM((i=>{if(consoleDebug(),i){var s={id:"",liveUserId:"",connectionId:"",platform:"WEB",bundleId:"",userKey:`${e}`,userName:`${t}`,fullName:`${o}`,userEmail:"",userPhone:"",userAvatar:"",userFollower:0,tokenFCM:`${i}`,tokenVoIP:"",moreData:"",isOnline:!0,created:null,updated:null};liveMeshHub.invoke("JoinServerLiveMesh",s,n).catch((e=>{consoleDebug(),notify("Không thể kết nối bạn với máy chủ tín hiệu")})),webRtcClass=new Webrtc(liveMeshHub,s,peerConnectionConfig,{log:false,warn:false,error:!0}),setOnEventListeners()}})):(e=`User ${Math.floor(1e4*Math.random()+1)}`,consoleDebug(),getTokenFCM((n=>{if(consoleDebug(),n){var i={id:"",liveUserId:"",connectionId:"",platform:"WEB",bundleId:"",userKey:`${e}`,userName:`${t}`,fullName:`${o}`,userEmail:"",userPhone:"",userAvatar:"",userFollower:0,tokenFCM:`${n}`,tokenVoIP:"",moreData:"",isOnline:!0,created:null,updated:null};liveMeshHub.invoke("JoinServerLiveMesh",i).catch((e=>{consoleDebug(),notify("Không thể kết nối bạn với máy chủ tín hiệu")})),webRtcClass=new Webrtc(liveMeshHub,i,peerConnectionConfig,{log:false,warn:false,error:!0}),setOnEventListeners()}})))})).catch((e=>{console.log(e)}))}liveMeshHub.onclose((e=>{e?(consoleDebug(),console.log(e)):consoleDebug(),webRtcClass=void 0})),liveMeshHub.on("UpdateRoomId",(async(e,t)=>{consoleDebug(JSON.stringify(t)),$("#_roomId").val(`${t}`)}));var webRtcClass=void 0;const notify=e=>{$("#_notification").html(`${e}`)};function setOnEventListeners(){webRtcClass&&(webRtcClass.addEventListener("view_CreatedRoom",(e=>{const t=e.detail.roomId;consoleDebug(),notify(`Phòng live ID ${t} đã được tạo`),$("#_roomStatus").text(`Phòng live ID: ${t}`),$("#_btnCreateOrJoinRoom").attr("disabled",!0),$("#_btnLeaveRoom").attr("disabled",!1)})),webRtcClass.addEventListener("view_JoinedRoom",(e=>{const t=e.detail.roomId;consoleDebug(),notify(`Phòng live ID ${t} đã tham gia`),$("#_roomStatus").text(`Phòng live ID: ${t}`),$("#_btnCreateOrJoinRoom").attr("disabled",!0),$("#_btnLeaveRoom").attr("disabled",!1)})),webRtcClass.addEventListener("view_Kicked",(()=>{$("#_roomStatus").text("Bạn đã bị đá ra ngoài phòng live"),$("#_videoGrid").html(""),$("#_btnCreateOrJoinRoom").attr("disabled",!1),$("#_btnLeaveRoom").attr("disabled",!0)})),webRtcClass.addEventListener("view_LeaveRoom",(e=>{const t=e.detail.roomId;$("#_roomStatus").text(""),notify(`Bạn rời khỏi phòng live ID ${t}`),$("#_btnCreateOrJoinRoom").attr("disabled",!1),$("#_btnLeaveRoom").attr("disabled",!0)})),webRtcClass.addEventListener("view_NewUser",(e=>{const t=e.detail.userKey,o=e.detail.stream,n=document.createElement("div");n.setAttribute("class","grid-item"),n.setAttribute("id",t);const i=document.createElement("video");i.setAttribute("autoplay",!0),i.setAttribute("muted",!1),i.setAttribute("playsinline",!0),i.srcObject=o;const s=document.createElement("p");if(s.textContent=t,n.append(s),n.append(i),webRtcClass._isAdmin){const e=document.createElement("button");e.setAttribute("class","kick_btn"),e.textContent="Chặn",e.addEventListener("click",(()=>{webRtcClass.kickUser(t)})),n.append(e)}$("#_videoGrid").append(n)})),webRtcClass.addEventListener("view_RemoveUser",(e=>{const t=e.detail.userKey;t?document.getElementById(t)&&document.getElementById(t).remove():$("#_videoGrid").html("")})),webRtcClass.addEventListener("view_NewError",(e=>{const t=e.detail.error;consoleDebug(),notify(t)})),webRtcClass.addEventListener("view_NewNotification",(e=>{const t=e.detail.notification;consoleDebug(),notify(t)})))}function hubCreateOrJoinRoom(e,t,o){var n=$("#_roomId").val();consoleDebug(),webRtcClass.getCameraStream(e,t,o,!0,{width:640,height:480}).then((e=>{const t=e.getVideoTracks();if(t.length>0){consoleDebug(t[0].label);var o=document.getElementById("_localVideo");void 0!==o&&o.srcObject!==e&&(o.srcObject=e)}webRtcClass.joinRoom(n)}))}function hubJoinRoom(e,t,o){var n=$("#_roomId").val();consoleDebug();var i={id:"",liveUserId:"",connectionId:"",platform:"WEB",bundleId:"",userKey:`${e}`,userName:`${t}`,fullName:`${o}`,userEmail:"",userPhone:"",userAvatar:"",userFollower:0,tokenFCM:"",tokenVoIP:"",moreData:"",isOnline:!0,created:null,updated:null};liveMeshHub.invoke("CheckRoom",i,n).then((e=>{!0===e?(consoleDebug(),webRtcClass.joinRoom(n)):(consoleDebug(),notify(`Phòng live '${n}' không tồn tại`))})).catch((e=>{consoleDebug(),notify("Không thể kết nối bạn với máy chủ tín hiệu")}))}function hubSwichOffScreen(e,t,o){consoleDebug(),webRtcClass.getCameraStream(e,t,o,!0,{width:640,height:480}).then((e=>{const t=e.getVideoTracks();if(t.length>0){consoleDebug(t[0].label);var o=document.getElementById("_localVideo");void 0!==o&&o.srcObject!==e&&(o.srcObject=e)}}))}function hubSwichOnScreen(e,t,o){consoleDebug(),webRtcClass.getScreenStream(e,t,o,(()=>{hubSwichOffScreen(e,t,o)})).then((e=>{const t=e.getVideoTracks();if(t.length>0){consoleDebug(t[0].label);var o=document.getElementById("_localVideo");void 0!==o&&o.srcObject!==e&&(o.srcObject=e)}}))}function hubLeaveRoom(e,t,o){$("#_roomId").val();consoleDebug(),webRtcClass.leaveRoom(e,t,o)}